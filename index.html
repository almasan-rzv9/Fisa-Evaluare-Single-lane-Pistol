<!doctype html>
<html lang="ro">
<head>
<meta charset="utf-8">
<title>Pistol Skills</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{--ink:#111;--muted:#555;--grid:#dcdcdc;--shade:#f7f7f7}
  html,body{background:#fff;color:var(--ink);margin:0}
  body{font:16px/1.45 "Times New Roman", Times, serif}
  .wrap{max-width:870px;margin:28px auto 60px;padding:0 12px}
  h1{margin:0 0 12px;text-align:center;font-size:38px;letter-spacing:.5px;font-weight:700}

  .meta{margin:10px 0 8px}
  .meta-row{display:flex;align-items:center;gap:18px;margin:8px 0}
  .lbl{font-style:italic;min-width:170px}
  .line-input{
    flex:1;border:0;border-bottom:1px solid #999;padding:6px 6px;
    font:16px/1.2 "Times New Roman", Times, serif;outline:none;background:transparent;
  }

  .note{margin:8px 0 12px}
  .rule{height:1px;background:#a8a8a8;margin:16px 0 10px}

  .toolbar{display:flex;justify-content:flex-end;gap:8px;margin:6px 0 8px}
  .btn{font:15px/1 "Times New Roman", Times, serif;border:1px solid #999;background:#efefef;padding:6px 10px;cursor:pointer}
  .btn:active{transform:translateY(1px)}

  /* panouri (Core, Harta, Ținte) */
  details.core, details.map, details.targets{
    margin:8px 0 12px; border:1px solid #cfcfcf; background:#fbfbfb; border-radius:6px;
  }
  details.core[open], details.map[open], details.targets[open]{background:#f6f6f6}
  details.core > summary, details.map > summary, details.targets > summary{
    list-style:none; cursor:pointer; padding:8px 10px; display:flex; align-items:center; gap:8px;
    font-weight:700;
  }
  details.core > summary::-webkit-details-marker,
  details.map > summary::-webkit-details-marker,
  details.targets > summary::-webkit-details-marker{display:none}
  .chev{display:inline-block; transition:transform .2s}
  details.core[open] .chev, details.map[open] .chev, details.targets[open] .chev{transform:rotate(90deg)}
  .core-content, .map-content, .targets-content{padding:0 14px 12px 26px}
  .core-content ol{margin:0; padding-left:18px}
  .core-content li, .map-content li{margin:6px 0}
  .map-content p{margin:6px 0 10px}
  .map-content .sub{margin-left:12px;margin-top:4px}
  .map-content .muted{color:var(--muted);font-size:14px}
  .targets-list{margin:6px 0 0; padding-left:18px}
  .targets-list li{margin:6px 0}
  .targets a{text-decoration:none}

  table{width:100%;border-collapse:collapse}
  thead th{font-style:italic;text-align:left;padding:6px 8px;border-bottom:2px solid #000;white-space:nowrap}
  tbody td{padding:6px 8px;border-bottom:1px solid var(--grid);vertical-align:top}
  tbody tr:nth-child(even) td{background:var(--shade)}
  .c-idx{width:28px;text-align:right}
  .c-skill{width:260px}
  .c-drill{width:300px}
  .c-dist{width:85px;white-space:nowrap}
  .c-lov{width:70px;text-align:center}
  .c-pts,.c-time,.c-hf{width:90px;text-align:center}

  .b{font-weight:700}
  .i{font-style:italic}
  .lov{display:inline-block;min-width:36px;padding:0 6px;background:#e9e9e9;border-radius:3px}

  input[type="number"], input[type="text"], input[type="date"]{
    width:88px;padding:4px 6px;border:1px solid #888;border-radius:4px;
    font:16px "Times New Roman", Times, serif;background:#fff;
  }
  .hf-box{min-height:28px;padding:4px 6px;border:1px solid #bbb;border-radius:4px;background:#fff}

  .tot{margin-top:10px}
  .foot{margin-top:6px;color:var(--muted)}

  /* footer pentru PDF */
  .print-footer{display:none}

  @page{size:A4;margin:16mm 14mm}
  @media print{
    .wrap{margin:0 auto;padding:0}
    .toolbar, details.core, details.map, details.targets{display:none}
    .line-input{border-bottom:1px solid #000}
    input[type="number"], input[type="text"], input[type="date"]{border:1px solid #999}
    .print-footer{
      display:block; position:fixed; bottom:8mm; left:14mm; right:14mm;
      text-align:right; font-size:12px; color:#000;
    }
  }
  @media (max-width:520px){
    .wrap{padding:0 10px}
    input[type="number"], input[type="text"]{width:68px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Pistol Skills</h1>

    <div class="meta">
      <div class="meta-row">
        <div class="lbl">Data:</div>
        <input id="fld_date" class="line-input" type="date" />
      </div>
      <div class="meta-row">
        <div class="lbl">Trăgător:</div>
        <input id="fld_shooter" class="line-input" type="text" placeholder="Nume & prenume" />
      </div>
      <div class="meta-row">
        <div class="lbl">Arma:</div>
        <input id="fld_gun" class="line-input" type="text" placeholder="Model / Calibru" />
      </div>
      <div class="meta-row">
        <div class="lbl">Autor (footer PDF):</div>
        <input id="fld_author" class="line-input" type="text" placeholder="Numele tău pentru footer" />
      </div>
    </div>

    <div class="note">
      Cold * Iron Sights * A4 (piept) = <b>1p</b> * A6 (cap) = <b>2p</b> * Pauza intre runde <b>2'</b> * Distanta laser. * Holster
    </div>

    <!-- Core skills -->
    <details class="core">
      <summary><span class="chev">▶</span> Core skills</summary>
      <div class="core-content">
        <ol>
          <li>Safe gun handling & consistency</li>
          <li>Draw to first shot (from holster)</li>
          <li>Sight acquisition & visual cadence</li>
          <li>Trigger control / precision</li>
          <li>Grip & recoil management (splits)</li>
          <li>Target transitions</li>
          <li>Tactical/Speed reloads</li>
          <li>SHO/WHO control (strong-hand only / weak-hand only)</li>
          <li>Distance change-ups (near ↔ far)</li>
          <li>Throttle control (speed vs accuracy under par time)</li>
        </ol>
      </div>
    </details>

    <!-- Harta skill -> Drill -->
    <details class="map">
      <summary><span class="chev">▶</span> Harta skill → Drill</summary>
      <div class="map-content">
        <ol>
          <li>
            <b>Safe gun handling & consistency</b>
            <div class="sub">
              • <b>Mini Super Test</b> (5 focuri/string) — A6 (cap) la 15 m și A4 (piept) la 10 m și 5 m:<br>
              &nbsp;&nbsp;◦ 15 m: 5 în A6 în <b>7,50 s</b><br>
              &nbsp;&nbsp;◦ 10 m: 5 în A4 în <b>5,00 s</b><br>
              &nbsp;&nbsp;◦ 5 m: 5 în A4 în <b>2,50 s</b><br>
              &nbsp;&nbsp;<span class="muted">Muniție: 15 • Scor: numără loviturile în interiorul zonei țintă.</span>
            </div>
          </li>
          <li>
            <b>Draw to first shot (from holster)</b>
            <div class="sub">
              • <b>Draw-to-1</b> (7 m): 1 foc în A4.<br>
              &nbsp;&nbsp;<span class="muted">Par orientativ: 1,60 s / 1,30 s / 1,00 s • Muniție: 10 (10 rep).</span>
            </div>
          </li>
          <li>
            <b>Sight acquisition & visual cadence</b>
            <div class="sub">
              • <b>Doubles</b> (7 m): 2 focuri rapide în A4; urmărești splitul.<br>
              &nbsp;&nbsp;<span class="muted">Țintă split: ~0,25 / ~0,22 / ≤0,18 s • Muniție: 20 (10 rep).</span>
            </div>
          </li>
          <li>
            <b>Trigger control / precision</b>
            <div class="sub">
              • <b>3×5 Head Box</b> → adaptat cu A6 (7 m): Draw → 1 foc în A6.<br>
              &nbsp;&nbsp;<span class="muted">Par: 2,50 s / 2,00 s / 1,60 s • Muniție: 5 (5 rep).</span>
            </div>
          </li>
          <li>
            <b>Grip & recoil management (splits)</b>
            <div class="sub">
              • <b>Bill Drill</b> (7 m): 6 focuri continue în A4.<br>
              &nbsp;&nbsp;<span class="muted">Par orientativ (curat): 4,0–3,5 s / 3,2–2,7 s / ≤2,4 s • Muniție: 6/rep.</span>
            </div>
          </li>
          <li>
            <b>Target transitions (single-lane)</b>
            <div class="sub">
              • <b>3-Dot Sweep</b> adaptat: A6 stânga – A4 centru – A6 dreapta; tragi 2-2-2 în ordinea aleasă.<br>
              &nbsp;&nbsp;<span class="muted">Par: 4,0–3,5 s / 3,3–2,9 s / ≤2,7 s • Muniție: 6/rep.</span>
            </div>
          </li>
          <li>
            <b>Emergency reloads</b>
            <div class="sub">
              • <b>1R1</b> (7 m): 1 în A4 → reload → 1 în A4.<br>
              &nbsp;&nbsp;<span class="muted">Par: 3,50 s / 2,80 s / 2,40 s • Muniție: 10 (5 rep).</span>
            </div>
          </li>
          <li>
            <b>SHO/WHO control (one-handed)</b>
            <div class="sub">
              • <b>Standards</b> (7 m): 5 SHO în A4 în 7,0 s + 5 WHO în A4 în 8,0 s.<br>
              &nbsp;&nbsp;<span class="muted">Muniție: 10 • (Opțional: cap = A6).</span>
            </div>
          </li>
          <li>
            <b>Distance change-ups (near ↔ far)</b>
            <div class="sub">
              • <b>Size Change-Up (pe loc)</b>: 5 în A6 în 5,0 s → 5 în A4 în 3,5 s (la aceeași distanță).<br>
              &nbsp;&nbsp;<span class="muted">Muniție: 10/ciclu.</span>
            </div>
          </li>
          <li>
            <b>Throttle control (speed vs accuracy)</b>
            <div class="sub">
              • <b>FAST</b> (7 m): 2 în A6 → reload → 4 în A4.<br>
              &nbsp;&nbsp;<span class="muted">Par: 9–7 s / 7–5 s / ≤5,0 s • Muniție: 6/rep.</span>
            </div>
          </li>
        </ol>
      </div>
    </details>

    <!-- ȚINTE PDF (descărcare) -->
    <details class="targets">
      <summary><span class="chev">▶</span> Ținte PDF (descărcare/printare)</summary>
      <div class="targets-content">
        <ul class="targets-list" id="targets-list"></ul>
        <p class="muted">Tip: la print, setează „Scale/Scalează: 100% (Actual size)” și „Paper size: A4”.</p>
      </div>
    </details>

    <div class="rule"></div>

    <div class="toolbar">
      <button class="btn" onclick="window.print()">Exportă PDF</button>
      <button class="btn" id="clear">Curăță fișa</button>
    </div>

    <table id="sheet">
      <thead>
        <tr>
          <th class="c-idx">#</th>
          <th class="c-skill i">Skill (1–10)</th>
          <th class="c-drill i">Drill (principal)</th>
          <th class="c-dist i">Distanță</th>
          <th class="c-lov i">Focuri</th>
          <th class="c-pts i">Puncte</th>
          <th class="c-time i">Timp (s)</th>
          <th class="c-hf i">HF</th>
        </tr>
      </thead>
      <tbody>
        <!-- rânduri editabile; HF se calculează automat -->
        <tr><td class="c-idx">1.</td><td>Safe gun handling & consistency</td><td><span class="b">Mini Super Test</span> – string 1</td><td class="b">15 m</td><td><span class="lov">/3</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">2.</td><td>Safe gun handling & consistency</td><td><span class="b">Mini Super Test</span> – string 2</td><td class="b">10 m</td><td><span class="lov">/3</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">3.</td><td>Safe gun handling & consistency</td><td><span class="b">Mini Super Test</span> – string 3</td><td class="b">5 m</td><td><span class="lov">/3</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">4.</td><td>Draw to first shot</td><td class="b">Draw-to-1</td><td>7 m</td><td><span class="lov">/1</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">5.</td><td>Sight acquisition & cadence</td><td class="b">Doubles</td><td>7 m</td><td><span class="lov">/4</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">6.</td><td>Trigger control / precision</td><td class="b">Head shot</td><td>7 m</td><td><span class="lov">/4</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">7.</td><td>Grip & recoil (splits)</td><td class="b">Bill Drill</td><td>7 m</td><td><span class="lov">/6</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">8.</td><td>Target transitions</td><td class="b">3-Target Sweep</td><td>7 m</td><td><span class="lov">/6</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">9.</td><td>Emergency reloads</td><td class="b">1R1</td><td>7 m</td><td><span class="lov">/2</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">10.</td><td>SH control</td><td class="b">SHO</td><td>5 m</td><td><span class="lov">/3</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">11.</td><td>WH control</td><td class="b">WHO</td><td>5 m</td><td><span class="lov">/3</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">12.</td><td>Distance change-ups</td><td class="b">Size Change-Up (pe loc)</td><td>7–10 m</td><td><span class="lov">/6</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
        <tr><td class="c-idx">13.</td><td>Throttle control</td><td class="b">FAST (2 cap → rl → 4 piept)</td><td>7 m</td><td><span class="lov">cap: /2<br>piept: /4</span></td><td><input inputmode="numeric" type="number" step="1" class="pts"></td><td><input inputmode="decimal" type="number" step="0.01" class="time"></td><td><div class="hf-box"></div></td></tr>
      </tbody>
    </table>

    <div class="tot"><b>Total muniție</b> 50</div>
    <div class="foot">Completezi <b>Puncte</b> și <b>Timp</b>. <b>HF</b> se calculează automat. Apoi „Exportă PDF”.</div>
  </div>

  <!-- Footer render-only pentru PDF -->
  <div class="print-footer" id="printFooter"></div>

  <script>
    function fmt(v, d=2){ return (isFinite(v) && v!=='') ? Number(v).toFixed(d) : ''; }

    function updateFooter(){
      const author = document.getElementById('fld_author').value?.trim() || '';
      const dateStr = document.getElementById('fld_date').value || '';
      const footer = document.getElementById('printFooter');
      footer.textContent = author ? `© ${author}${dateStr ? ' — ' + dateStr : ''}` : (dateStr ? dateStr : '');
    }

    function recalcAndSave(){
      const rowsData = [];
      document.querySelectorAll('#sheet tbody tr').forEach(tr=>{
        const ptsEl = tr.querySelector('.pts');
        const timeEl = tr.querySelector('.time');
        const hfBox = tr.querySelector('.hf-box');
        const pts = ptsEl && ptsEl.value !== '' ? parseFloat(ptsEl.value) : null;
        const time = timeEl && timeEl.value !== '' ? parseFloat(timeEl.value) : null;
        const hf = (time && time>0 && pts !== null) ? (pts / time) : '';
        hfBox.textContent = hf === '' ? '' : fmt(hf,2);
        rowsData.push({pts: ptsEl.value || '', time: timeEl.value || ''});
      });

      const header = {
        date: document.getElementById('fld_date').value || '',
        shooter: document.getElementById('fld_shooter').value || '',
        gun: document.getElementById('fld_gun').value || '',
        author: document.getElementById('fld_author').value || ''
      };
      localStorage.setItem('fisa_eval_state_v3', JSON.stringify({header, rows: rowsData}));
      updateFooter();
    }

    function restore(){
      try{
        const raw = localStorage.getItem('fisa_eval_state_v3');
        if(!raw) return;
        const obj = JSON.parse(raw);
        if(obj.header){
          document.getElementById('fld_date').value = obj.header.date || '';
          document.getElementById('fld_shooter').value = obj.header.shooter || '';
          document.getElementById('fld_gun').value = obj.header.gun || '';
          document.getElementById('fld_author').value = obj.header.author || '';
        }
        if(Array.isArray(obj.rows)){
          const rows = [...document.querySelectorAll('#sheet tbody tr')];
          obj.rows.forEach((r,i)=>{
            const tr = rows[i]; if(!tr) return;
            tr.querySelector('.pts').value = r.pts || '';
            tr.querySelector('.time').value = r.time || '';
          });
        }
        updateFooter();
        document.title = 'Pistol Skills';
      }catch(e){ console.error(e) }
    }

    // --- ȚINTE: construiește lista din folderul ./targets/ ---
    const pathPrefix = "./targets/";
    const targets = [
      ["target-uspsa-a-zone-a4.pdf","USPSA A-Zone (A4) — imprimare 100%"],
      ["target-bullseye.pdf","Bullseye clasic (score sheet)"],
      ["drill-3-2-1-target.pdf","3-2-1 / 6-4-2 target"],
      ["drill-cadence-bars-5m.pdf","Cadence Bars – 5 m"],
      ["drill-cadence-bars-7m.pdf","Cadence Bars – 7 m"],
      ["drill-dice-5m.pdf","Dice Drill – 5 m"],
      ["drill-diminishing-dot.pdf","Diminishing Dot"],
      ["drill-grid-square-center.pdf","Grid Square – Center"],
      ["drill-red-dot.pdf","Red Dot zero/confirm"],
      ["drill-risky-business-qr.pdf","„Risky Business” (QR)"]
    ];
    function buildTargets(){
      const ul = document.getElementById("targets-list");
      if(!ul) return;
      targets.forEach(([file,label])=>{
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = pathPrefix + file;
        a.textContent = label;
        a.setAttribute("download", "");
        a.target = "_blank"; a.rel = "noopener";
        li.appendChild(a);
        ul.appendChild(li);
      });
    }

    // init
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('details.core, details.map, details.targets').forEach(d => d.removeAttribute('open'));
      restore();
      buildTargets();
    });

    document.addEventListener('input', (e)=>{
      if(e.target.matches('.pts, .time, #fld_date, #fld_shooter, #fld_gun, #fld_author')) recalcAndSave();
    });

    document.getElementById('clear')?.addEventListener('click', ()=>{
      document.getElementById('fld_date').value = '';
      document.getElementById('fld_shooter').value = '';
      document.getElementById('fld_gun').value = '';
      document.getElementById('fld_author').value = '';
      document.querySelectorAll('.pts,.time').forEach(i => i.value = '');
      localStorage.removeItem('fisa_eval_state_v3');
      recalcAndSave();
    });
  </script>
</body>
</html>
